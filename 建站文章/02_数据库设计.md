# 数据库设计

本文详细介绍了 Laravel Blog 项目的数据库设计方案。该设计支持完整的用户管理、权限控制和文章管理功能。

## 🎯 设计目标

- **用户管理**: 支持多用户系统，实现三级权限控制
- **文章管理**: 支持文章的创建、编辑、发布和状态管理
- **权限隔离**: 不同角色用户有不同的数据访问权限
- **时间追踪**: 自动记录数据的创建和更新时间
- **会话管理**: 支持用户"记住我"功能

## 📊 数据库概览

项目使用 **MySQL 8.0** 作为数据库，包含以下核心表：

| 表名 | 功能描述 | 记录数量 |
|------|----------|----------|
| `users` | 用户管理，权限控制 | 3个默认用户 |
| `posts` | 文章管理，内容存储 | 2篇示例文章 |

## 👥 Users 表设计

### 功能说明
用户表是整个系统的核心，负责用户认证、权限管理和会话控制。

### 字段设计

| 字段名 | 数据类型 | 约束 | 默认值 | 功能说明 |
|--------|----------|------|--------|----------|
| `user_id` | BIGINT UNSIGNED | 主键，自增 | - | 用户唯一标识 |
| `name` | VARCHAR(255) | 非空 | - | 用户名，用于登录 |
| `password` | VARCHAR(255) | 非空 | - | 加密后的密码 |
| `role` | ENUM | 非空 | 'viewer' | 用户角色：admin/editor/viewer |
| `remember_token` | VARCHAR(100) | 可空 | NULL | 会话令牌，支持"记住我" |
| `created_at` | DATETIME | 可空 | CURRENT_TIMESTAMP | 创建时间 |
| `updated_at` | DATETIME | 可空 | CURRENT_TIMESTAMP | 更新时间 |

### 角色权限说明

| 角色 | 权限范围 | 功能描述 |
|------|----------|----------|
| **admin** | 完全权限 | 可管理所有用户和文章，访问后台所有功能 |
| **editor** | 编辑权限 | 只能管理自己的文章，无法管理其他用户 |
| **viewer** | 查看权限 | 只能查看已发布的文章，无法访问管理功能 |

### SQL 建表语句

```sql
CREATE TABLE `users` (
  `user_id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(255) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `role` ENUM('admin', 'editor', 'viewer') NOT NULL DEFAULT 'viewer',
  `remember_token` VARCHAR(100) NULL,
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 📝 Posts 表设计

### 功能说明
文章表负责存储所有文章内容，支持 Markdown 格式，实现文章的完整生命周期管理。

### 字段设计

| 字段名 | 数据类型 | 约束 | 默认值 | 功能说明 |
|--------|----------|------|--------|----------|
| `post_id` | BIGINT UNSIGNED | 主键，自增 | - | 文章唯一标识 |
| `user_id` | BIGINT UNSIGNED | 外键，非空 | - | 作者ID，关联users表 |
| `title` | VARCHAR(255) | 非空 | - | 文章标题 |
| `slug` | VARCHAR(255) | 唯一，非空 | - | URL友好标识 |
| `status` | ENUM | 非空 | 'draft' | 文章状态：published/draft/deleted |
| `published_at` | DATETIME | 可空 | NULL | 发布时间 |
| `subtitle` | VARCHAR(255) | 可空 | NULL | 副标题 |
| `content_markdown` | LONGTEXT | 可空 | NULL | Markdown格式的文章内容 |
| `created_at` | DATETIME | 可空 | CURRENT_TIMESTAMP | 创建时间 |
| `updated_at` | DATETIME | 可空 | CURRENT_TIMESTAMP | 更新时间 |

### 状态管理说明

| 状态 | 描述 | 可见性 |
|------|------|--------|
| **draft** | 草稿状态 | 仅作者可见 |
| **published** | 已发布 | 所有用户可见 |
| **deleted** | 已删除 | 仅管理员可见 |

### SQL 建表语句

```sql
CREATE TABLE `posts` (
  `post_id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `slug` VARCHAR(255) NOT NULL,
  `status` ENUM('published', 'draft', 'deleted') NOT NULL DEFAULT 'draft',
  `published_at` DATETIME DEFAULT NULL,
  `subtitle` VARCHAR(255) DEFAULT NULL,
  `content_markdown` LONGTEXT DEFAULT NULL,
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`post_id`),
  UNIQUE KEY `posts_slug_unique` (`slug`),
  FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 🔧 数据库连接配置

### 环境变量配置
```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel_blog
DB_USERNAME=laravel_user
DB_PASSWORD=laravel_pass
```

### 字符编码配置

项目使用 `utf8mb4` 字符集，确保完美支持中文和 Emoji：

```sql
-- 设置默认字符集
SET NAMES utf8mb4;
SET CHARACTER SET utf8mb4;

-- 创建数据库
CREATE DATABASE IF NOT EXISTS laravel_blog 
CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

**为什么使用 utf8mb4？**
- 支持完整的 Unicode 字符集
- 完美支持中文、Emoji 等所有字符
- Laravel 官方推荐的标准配置

每个表都使用相同的字符集配置：
```sql
DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
```

这个数据库设计为 Laravel Blog 项目提供了坚实的数据基础，支持完整的博客功能需求。
