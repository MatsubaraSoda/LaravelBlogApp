# 容器与部署

记录容器环境与部署要点（Ubuntu 22.04，All-in-One）。

## 构建与运行

```bash
docker build -t laravelblog:ver06 -f Dockerfile.06 .
docker run -d -p 8080:80 --name LaravelBlogApp06 \
  -e APP_URL=http://localhost:8080 \
  laravelblog:ver06
```

## 端口与访问
- Web: 80（宿主映射 8080）
- MySQL: 3306
- 前台: http://localhost:8080
- 后台: http://localhost:8080/admin

## 启动流程（start.sh）
- 启动 MySQL，等待就绪
- 启动 PHP-FPM 8.1
- 启动 Nginx
- 如无表则执行 `php artisan migrate --force`
- 清理缓存、设置 `storage` 与 `bootstrap/cache` 权限

## 环境变量（镜像内）
```env
APP_ENV=local
APP_DEBUG=true
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel_blog
DB_USERNAME=laravel_user
DB_PASSWORD=laravel_pass
```

## 数据库初始化（mysql-init.sql）
- 创建数据库与用户，授权本地访问
- 表结构：`users`、`posts`
- 预置数据：三位用户与两篇示例文章
- 编码：`utf8mb4` / `utf8mb4_unicode_ci`

## 文件与目录
- Nginx 站点：`/etc/nginx/sites-available/default`
- PHP-FPM 池：`/etc/php/8.1/fpm/pool.d/www.conf`
- 应用目录：`/var/www/laravel`
- 日志：`/var/log/nginx/laravel_access.log`、`laravel_error.log`

## 常用只读检查
```bash
service --status-all | cat
ps aux | grep -E "nginx|php-fpm|mysql" | cat
tail -n 200 /var/log/nginx/laravel_error.log
```
